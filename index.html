<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ä¸»åŒ…çš„ç¥ç§˜å…¥å£</title>
  <style>
    :root{
      --bg1:#0b1020;
      --bg2:#141a33;
      --card:#10162b;
      --card2:#0f1a3a;
      --text:#eaf0ff;
      --muted:#aab6ff;
      --accent:#7c5cff;
      --accent2:#00d4ff;
      --ok:#22c55e;
      --bad:#ef4444;
      --warn:#f59e0b;
      --shadow: 0 18px 55px rgba(0,0,0,.45);
      --radius: 18px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, "PingFang SC","Microsoft YaHei", Arial, sans-serif;
      color:var(--text);
      background:
        radial-gradient(1200px 600px at 20% 10%, rgba(124,92,255,.35), transparent 50%),
        radial-gradient(900px 500px at 80% 20%, rgba(0,212,255,.25), transparent 55%),
        radial-gradient(800px 600px at 40% 90%, rgba(34,197,94,.18), transparent 55%),
        linear-gradient(180deg, var(--bg1), var(--bg2));
      overflow-x:hidden;
    }
    .wrap{max-width:980px;margin:0 auto;padding:26px 18px 60px}
    .topbar{
      display:flex;align-items:center;justify-content:space-between;gap:12px;
      margin-bottom:18px;
    }
    .brand{
      display:flex;align-items:center;gap:10px;
      user-select:none;
    }
    .logo{
      width:42px;height:42px;border-radius:14px;
      background: conic-gradient(from 210deg, var(--accent), var(--accent2), var(--ok), var(--accent));
      box-shadow: 0 8px 30px rgba(124,92,255,.35);
      position:relative;
    }
    .logo:after{
      content:"â˜…";
      position:absolute;inset:0;
      display:grid;place-items:center;
      color:#0b1020;
      font-weight:900;
      text-shadow: 0 0 0 rgba(0,0,0,0);
    }
    .title{
      line-height:1.1;
    }
    .title h1{margin:0;font-size:18px;letter-spacing:.6px}
    .title p{margin:4px 0 0;color:var(--muted);font-size:12px}
    .pill{
      display:inline-flex;align-items:center;gap:8px;
      background:rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.1);
      padding:10px 12px;border-radius:999px;
      box-shadow: 0 8px 26px rgba(0,0,0,.25);
      color:var(--muted);
      font-size:12px;
    }
    .pill b{color:var(--text)}
    .grid{
      display:grid;
      grid-template-columns: 1.05fr .95fr;
      gap:16px;
      align-items:start;
    }
    @media (max-width:900px){
      .grid{grid-template-columns:1fr}
    }

    .card{
      background: linear-gradient(180deg, rgba(255,255,255,.07), rgba(255,255,255,.03));
      border:1px solid rgba(255,255,255,.10);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding:18px;
      position:relative;
      overflow:hidden;
    }
    .card:before{
      content:"";
      position:absolute;inset:-60px;
      background: radial-gradient(300px 160px at 10% 10%, rgba(124,92,255,.22), transparent 60%),
                  radial-gradient(280px 150px at 90% 30%, rgba(0,212,255,.16), transparent 60%);
      pointer-events:none;
    }
    .card > *{position:relative}
    .h2{margin:0 0 8px;font-size:18px}
    .sub{margin:0 0 14px;color:var(--muted);font-size:13px;line-height:1.6}
    .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
    .input{
      flex:1;
      min-width:220px;
      background:rgba(10,14,28,.75);
      border:1px solid rgba(255,255,255,.12);
      color:var(--text);
      padding:12px 12px;
      border-radius:14px;
      outline:none;
      font-size:14px;
    }
    .btn{
      background: linear-gradient(90deg, var(--accent), var(--accent2));
      border:none;color:#051022;
      padding:12px 14px;border-radius:14px;
      font-weight:800;
      cursor:pointer;
      box-shadow: 0 10px 26px rgba(0,212,255,.22);
      transition: transform .08s ease;
      user-select:none;
    }
    .btn:active{transform: translateY(1px) scale(.99)}
    .btn.ghost{
      background:rgba(255,255,255,.06);
      color:var(--text);
      border:1px solid rgba(255,255,255,.12);
      box-shadow:none;
      font-weight:700;
    }
    .hint{
      display:flex;gap:10px;align-items:flex-start;
      padding:12px 12px;border-radius:14px;
      background:rgba(124,92,255,.10);
      border:1px dashed rgba(124,92,255,.35);
      color:var(--muted);
      font-size:13px;
      line-height:1.55;
    }
    .hint .tag{
      flex:0 0 auto;
      font-weight:900;
      color:var(--text);
      background:rgba(124,92,255,.25);
      border:1px solid rgba(124,92,255,.35);
      padding:2px 8px;border-radius:999px;
      margin-top:1px;
    }
    .msg{
      margin-top:10px;
      font-size:13px;
      color:var(--muted);
      min-height:20px;
    }
    .msg.ok{color:rgba(34,197,94,.95)}
    .msg.bad{color:rgba(239,68,68,.95)}
    .msg.warn{color:rgba(245,158,11,.95)}

    .side{
      display:flex;
      flex-direction:column;
      gap:16px;
    }
    .mini{
      background:rgba(10,14,28,.55);
      border:1px solid rgba(255,255,255,.10);
      border-radius: var(--radius);
      padding:14px;
    }
    .mini h3{margin:0 0 6px;font-size:14px}
    .mini p{margin:0;color:var(--muted);font-size:13px;line-height:1.6}
    .kpi{
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap:10px;margin-top:10px
    }
    .kpi .box{
      background:rgba(255,255,255,.05);
      border:1px solid rgba(255,255,255,.10);
      border-radius:14px;
      padding:10px;
      text-align:center;
    }
    .kpi .n{font-size:18px;font-weight:900}
    .kpi .l{font-size:12px;color:var(--muted);margin-top:2px}

    /* Main game */
    .hidden{display:none !important}
    .gameTop{
      display:flex;gap:12px;flex-wrap:wrap;align-items:center;justify-content:space-between;
      margin-bottom:12px;
    }
    .progress{
      flex:1;min-width:220px;
      height:12px;border-radius:999px;
      background:rgba(255,255,255,.08);
      border:1px solid rgba(255,255,255,.10);
      overflow:hidden;
    }
    .bar{
      height:100%;
      width:0%;
      background: linear-gradient(90deg, var(--ok), var(--accent2), var(--accent));
      border-radius:999px;
      transition: width .35s ease;
    }
    .step{
      display:inline-flex;gap:8px;align-items:center;
      color:var(--muted);font-size:12px;
      background:rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.10);
      padding:8px 10px;border-radius:999px;
      user-select:none;
    }
    .panel{
      background:rgba(10,14,28,.55);
      border:1px solid rgba(255,255,255,.10);
      border-radius:var(--radius);
      padding:16px;
    }
    .panel h3{margin:0 0 8px;font-size:16px}
    .panel p{margin:0 0 14px;color:var(--muted);font-size:13px;line-height:1.7}

    /* Quiz */
    .choices{display:grid;gap:10px}
    .choice{
      padding:12px 12px;border-radius:14px;
      border:1px solid rgba(255,255,255,.12);
      background:rgba(255,255,255,.05);
      cursor:pointer;
      transition: transform .08s ease, border-color .2s ease;
      user-select:none;
    }
    .choice:hover{transform: translateY(-1px); border-color: rgba(0,212,255,.35)}
    .choice.correct{
      border-color: rgba(34,197,94,.65);
      background: rgba(34,197,94,.12);
    }
    .choice.wrong{
      border-color: rgba(239,68,68,.65);
      background: rgba(239,68,68,.10);
    }

    /* Drag match */
    .matchGrid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:12px;
      align-items:start;
    }
    @media (max-width:720px){.matchGrid{grid-template-columns:1fr}}
    .chips{
      display:flex;flex-wrap:wrap;gap:10px;
      min-height:54px;
    }
    .chip{
      padding:10px 12px;border-radius:999px;
      background:rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.12);
      cursor:grab;
      user-select:none;
      font-weight:700;
    }
    .chip:active{cursor:grabbing}
    .bins{display:grid;gap:10px}
    .bin{
      padding:12px;border-radius:14px;
      border:1px dashed rgba(255,255,255,.25);
      background:rgba(255,255,255,.04);
      min-height:52px;
    }
    .bin strong{display:block;margin-bottom:6px}
    .bin .drop{
      display:flex;flex-wrap:wrap;gap:8px;
      min-height:24px;
    }
    .bin.good{border-color: rgba(34,197,94,.55); background: rgba(34,197,94,.08)}
    .bin.bad{border-color: rgba(239,68,68,.55); background: rgba(239,68,68,.08)}

    /* Memory */
    .board{
      display:grid;
      grid-template-columns: repeat(4, 1fr);
      gap:10px;
    }
    @media (max-width:720px){.board{grid-template-columns: repeat(3,1fr)}}
    .tile{
      aspect-ratio: 1 / 1;
      border-radius:16px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.05);
      display:grid;place-items:center;
      cursor:pointer;
      font-size:28px;
      user-select:none;
      position:relative;
      overflow:hidden;
    }
    .tile.revealed{
      background: rgba(0,212,255,.12);
      border-color: rgba(0,212,255,.35);
    }
    .tile.matched{
      background: rgba(34,197,94,.12);
      border-color: rgba(34,197,94,.45);
      cursor:default;
    }
    .footerRow{
      display:flex;gap:10px;flex-wrap:wrap;align-items:center;justify-content:space-between;
      margin-top:14px;
    }
    .badge{
      font-size:12px;color:var(--muted);
      background:rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.10);
      padding:8px 10px;border-radius:999px;
    }
    .copybox{
      width:100%;
      padding:12px;border-radius:14px;
      background:rgba(10,14,28,.75);
      border:1px solid rgba(255,255,255,.12);
      color:var(--text);
      font-size:13px;line-height:1.6;
      white-space:pre-wrap;
    }

    /* Confetti */
    .confetti{
      position:fixed;inset:0;pointer-events:none;overflow:hidden;z-index:9999;
    }
    .confetti i{
      position:absolute;
      width:10px;height:16px;border-radius:3px;
      opacity:.95;
      animation: fall linear forwards;
      transform: translate3d(0,-20px,0) rotate(0deg);
      filter: drop-shadow(0 8px 10px rgba(0,0,0,.18));
    }
    @keyframes fall{
      to{
        transform: translate3d(var(--dx), 110vh, 0) rotate(720deg);
        opacity:1;
      }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="topbar">
      <div class="brand">
        <div class="logo"></div>
        <div class="title">
          <h1>ä¸»åŒ…çš„ç¥ç§˜å…¥å£</h1>
          <p>è¾“å…¥æ­£ç¡®å£ä»¤æ‰èƒ½è¿›æ¥ Â· è¿›æ¥å 5 åˆ†é’Ÿå·¦å³ç©å®Œä¸€ä¸ªè½»é‡å°æµç¨‹</p>
        </div>
      </div>
      <div class="pill" id="statusPill">çŠ¶æ€ï¼š<b>æœªéªŒè¯</b> ğŸ”’</div>
    </div>

    <!-- Gate -->
    <div class="grid" id="gate">
      <div class="card">
        <h2 class="h2">ğŸšª å…ˆè¿‡é—¨ç¦ï¼šè¯·è¾“å…¥å¯†ç </h2>
        <p class="sub">
          è§„åˆ™å¾ˆç®€å•ï¼šè¾“å…¥å¯¹äº†å°±æ”¾è¡Œï¼›è¾“å…¥é”™äº†ä¼šç»™ä½ ä¸€ç‚¹ç‚¹â€œæ›´æ¥è¿‘â€çš„æç¤ºã€‚
        </p>

        <div class="hint" style="margin-bottom:12px">
          <span class="tag">æç¤º</span>
          <div>
            å¯†ç æç¤ºæ˜¯ï¼š<b>ä¸»åŒ…çš„åå­—</b>ï¼ˆä¸‰ä¸ªå­—ï¼‰ã€‚<br/>
            ä½ ä¹Ÿå¯ä»¥æŠŠå®ƒç†è§£æˆï¼š<b>â€œä¸»åŒ…æœ¬äººèº«ä»½è¯æ˜â€</b> ğŸ˜„
          </div>
        </div>

        <div class="row">
          <input class="input" id="pwd" placeholder="è¯·è¾“å…¥ 3 ä¸ªå­—çš„å£ä»¤ï¼ˆä¾‹å¦‚ï¼šxxxï¼‰" maxlength="12" />
          <button class="btn" id="enterBtn">éªŒè¯å¹¶è¿›å…¥</button>
          <button class="btn ghost" id="demoBtn" title="æ¼”ç¤ºæŒ‰é’®ï¼šè‡ªåŠ¨å¡«å…¥æ­£ç¡®å¯†ç ">ä¸€é”®æ¼”ç¤º</button>
        </div>
        <div class="msg" id="gateMsg"></div>

        <div class="mini" style="margin-top:14px">
          <h3>ğŸ§  å°è´´å£«</h3>
          <p>è¾“å…¥æ—¶è¯·æ³¨æ„ï¼šä¸­æ–‡å…¨è§’/åŠè§’ä¸å½±å“ï¼Œä½†ä¼šè‡ªåŠ¨å¿½ç•¥å‰åç©ºæ ¼ã€‚</p>
        </div>
      </div>

      <div class="side">
        <div class="mini">
          <h3>ğŸ® è¿›å»ä»¥åç©ä»€ä¹ˆï¼Ÿ</h3>
          <p>ä¸€ä¸ªâ€œä¸»åŒ…è®¤è¯é—¯å…³â€å°æµç¨‹ï¼š<b>3å…³ + å½©è›‹</b>ã€‚æ¯å…³éƒ½ä¸éš¾ï¼Œä¸»è¦å›¾ä¸ªå¼€å¿ƒã€‚</p>
          <div class="kpi">
            <div class="box"><div class="n">3</div><div class="l">å…³å¡</div></div>
            <div class="box"><div class="n">5</div><div class="l">åˆ†é’Ÿå·¦å³</div></div>
            <div class="box"><div class="n">0</div><div class="l">å­¦ä¹ æˆæœ¬</div></div>
          </div>
        </div>
        <div class="mini">
          <h3>ğŸ§© æ¸©é¦¨æç¤º</h3>
          <p>å¦‚æœä½ å¸Œæœ›æ›´â€œå†…éƒ¨æ¢—â€ï¼ŒæŠŠç¬¬1å…³é¢˜ç›®/ç¬¬2å…³è¯æ¡æ¢æˆä½ ä»¬å›¢é˜Ÿçš„æ¢—å°±æ›´å¥½ç©ã€‚</p>
        </div>
      </div>
    </div>

    <!-- Game -->
    <div class="card hidden" id="game">
      <div class="gameTop">
        <div class="progress" aria-label="progress">
          <div class="bar" id="bar"></div>
        </div>
        <div class="step" id="stepText">ç¬¬ 1/3 å…³ï¼šæš–èº«å°é—®ç­”</div>
      </div>

      <!-- Panel 1: Quiz -->
      <div class="panel" id="panel1">
        <h3>ç¬¬ 1 å…³ï¼šæš–èº«å°é—®ç­”ï¼ˆé€‰å¯¹å°±è¿‡ï¼‰</h3>
        <p>
          ä¸»åŒ…è®¤è¯ç¬¬ä¸€æ­¥ï¼šç¡®è®¤ä½ æ˜¯â€œè®¤çœŸçœ‹é¢˜çš„äººâ€ã€‚åªæœ‰ä¸€é¢˜ï¼Œè½»æ¾ä¸€ä¸‹ï¼š
          <br/>ä¸‹é¢å“ªä¸ªé€‰é¡¹æœ€åƒâ€œè¿›å…¥ä¸€ä¸ªæœ‰è¶£ç½‘é¡µçš„æ­£ç¡®å§¿åŠ¿â€ï¼Ÿ 
        </p>
        <div class="choices" id="choices">
          <div class="choice" data-correct="0">A. ç›²çŒœ 100 æ¬¡ï¼Œç„¶åæ€ªé”®ç›˜</div>
          <div class="choice" data-correct="1">B. çœ‹æç¤ºã€åŠ¨è„‘å­ã€å¿«ä¹é€šå…³</div>
          <div class="choice" data-correct="0">C. æŠŠé¼ æ ‡ä¸¾è¿‡å¤´é¡¶è½¬ä¸‰åœˆå†ç‚¹</div>
          <div class="choice" data-correct="0">D. ä¸€è¾¹è·‘æ­¥ä¸€è¾¹è¾“å…¥å¯†ç æé«˜æˆåŠŸç‡</div>
        </div>
        <div class="msg" id="msg1"></div>
        <div class="footerRow">
          <span class="badge">æç¤ºï¼šæœ¬ç½‘é¡µçš„éšè—æŠ€èƒ½æ˜¯â€”â€”ä½ è¶Šè½»æ¾è¶Šå®¹æ˜“é€šå…³ ğŸ˜</span>
          <button class="btn hidden" id="to2">è¿›å…¥ç¬¬ 2 å…³</button>
        </div>
      </div>

      <!-- Panel 2: Drag match -->
      <div class="panel hidden" id="panel2">
        <h3>ç¬¬ 2 å…³ï¼šæ‹–æ‹½é…å¯¹ï¼ˆæŠŠè¯æ¡æ”¾è¿›æ­£ç¡®ç›’å­ï¼‰</h3>
        <p>
          æŠŠä¸‹æ–¹è¯æ¡æ‹–åˆ°ä½ è®¤ä¸ºæ­£ç¡®çš„ç›’å­é‡Œã€‚åªè¦å…¨å¯¹å°±è¿‡å…³ã€‚
          <br/>ï¼ˆæ”¾å¿ƒï¼šä¸€å…± 6 ä¸ªè¯æ¡ï¼Œ2 ä¸ªç›’å­ï¼Œå¾ˆå¿«ï¼ï¼‰
        </p>

        <div class="matchGrid">
          <div>
            <div class="badge" style="margin-bottom:10px">å¯æ‹–æ‹½è¯æ¡ï¼š</div>
            <div class="chips" id="chips"></div>
          </div>
          <div class="bins">
            <div class="bin" data-bin="fun">
              <strong>âœ… â€œæœ‰è¶£ç½‘é¡µâ€åº”æœ‰çš„ç‰¹å¾</strong>
              <div class="drop" id="dropFun"></div>
            </div>
            <div class="bin" data-bin="meh">
              <strong>ğŸŒ€ â€œä¸å¤ªæ¨èâ€çš„ç‰¹å¾</strong>
              <div class="drop" id="dropMeh"></div>
            </div>
            <div class="msg" id="msg2"></div>
            <div class="footerRow">
              <span class="badge">æç¤ºï¼šæœ‰è¶£ â‰  å¤æ‚ï¼›æœ‰è¶£ = æ¸…æ™° + äº’åŠ¨ + åé¦ˆ âœ¨</span>
              <button class="btn hidden" id="to3">è¿›å…¥ç¬¬ 3 å…³</button>
            </div>
          </div>
        </div>
      </div>

      <!-- Panel 3: Memory -->
      <div class="panel hidden" id="panel3">
        <h3>ç¬¬ 3 å…³ï¼šç¿»ç‰Œè®°å¿†ï¼ˆæ‰¾å‡ºæ‰€æœ‰é…å¯¹ï¼‰</h3>
        <p>
          è¿™æ˜¯æœ€åä¸€å…³ï¼šç¿»å¼€ä¸¤å¼ ç›¸åŒè¡¨æƒ…å°±ç®—é…å¯¹æˆåŠŸã€‚é…å¯¹å®Œæˆå³å¯é€šå…³ï¼
        </p>
        <div class="board" id="board"></div>
        <div class="footerRow">
          <span class="badge" id="moves">æ­¥æ•°ï¼š0</span>
          <span class="badge" id="pairs">é…å¯¹ï¼š0/6</span>
          <button class="btn ghost" id="resetMem">é‡ç½®è¿™ä¸€å…³</button>
        </div>
        <div class="msg" id="msg3"></div>
        <div class="footerRow" style="margin-top:10px">
          <span class="badge">å°æŠ€å·§ï¼šå…ˆæŠŠâ€œä½ çœ‹åˆ°çš„â€å½“æˆçº¿ç´¢ï¼Œè€Œä¸æ˜¯è´Ÿæ‹…ã€‚</span>
          <button class="btn hidden" id="finishBtn">é€šå…³ï¼é¢†å–ä¸»åŒ…è®¤è¯</button>
        </div>
      </div>

      <!-- Finish -->
      <div class="panel hidden" id="panel4">
        <h3>ğŸ‰ é€šå…³å•¦ï¼šä¸»åŒ…è®¤è¯è¯ä¹¦å·²ç”Ÿæˆ</h3>
        <p>
          æ­å–œä½ å®Œæˆäº† 3 å…³ã€‚ä½ å·²ç»å…·å¤‡â€œçœ‹æç¤ºã€ä¼šäº’åŠ¨ã€èƒ½é€šå…³â€çš„å®è´µå“è´¨ã€‚
          <br/>ä¸‹é¢è¿™æ®µè¯å¯ä»¥å¤åˆ¶å‘ç»™æœ‹å‹/ç¾¤é‡Œå½“å½©è›‹ï¼ˆå½“ç„¶ä¹Ÿå¯ä»¥è‡ªå·±å·å·å¼€å¿ƒä¸€ä¸‹ï¼‰ã€‚
        </p>
        <div class="copybox" id="cert"></div>
        <div class="footerRow">
          <button class="btn" id="copyBtn">ä¸€é”®å¤åˆ¶</button>
          <button class="btn ghost" id="replayBtn">å†ç©ä¸€é</button>
        </div>
        <div class="msg" id="msg4"></div>
      </div>
    </div>
  </div>

  <div class="confetti hidden" id="confetti"></div>

  <script>
    // ====== Gate ======
    const REAL_PASSWORD = "è€¿æ·‘ç";
    const gate = document.getElementById("gate");
    const game = document.getElementById("game");
    const pwd = document.getElementById("pwd");
    const enterBtn = document.getElementById("enterBtn");
    const demoBtn = document.getElementById("demoBtn");
    const gateMsg = document.getElementById("gateMsg");
    const statusPill = document.getElementById("statusPill");

    let attempts = 0;

    function normalize(s){
      return (s || "").trim().replace(/\s+/g,"");
    }

    function gateFeedback(input){
      // è½»é‡æç¤ºï¼šé•¿åº¦ã€æ˜¯å¦åŒ…å«æŸäº›å­—
      const target = REAL_PASSWORD;
      const n = normalize(input);
      if(!n) return {type:"warn", text:"å…ˆè¾“å…¥ç‚¹ä»€ä¹ˆå§ï½ï¼ˆæç¤ºï¼šä¸»åŒ…çš„åå­—ï¼Œä¸‰ä¸ªå­—ï¼‰"};
      if(n === target) return {type:"ok", text:"éªŒè¯é€šè¿‡ï¼æ¬¢è¿è¿›å…¥ä¸»åŒ…çš„ç¥ç§˜ä¸–ç•Œ ğŸ—ï¸"};
      const hints = [];
      if(n.length !== 3) hints.push("é•¿åº¦ä¸å¤ªå¯¹ï¼šæç¤ºè¯´æ˜¯â€œä¸‰ä¸ªå­—â€");
      // ç®€å•â€œæ¥è¿‘åº¦â€æç¤ºï¼ˆä¸æ³„éœ²å®Œæ•´å¯†ç ï¼‰
      let hit = 0;
      for(const ch of n){
        if(target.includes(ch)) hit++;
      }
      if(hit === 0) hints.push("ä½ è¾“å…¥çš„å­—å’Œæ­£ç¡®å£ä»¤é‡åˆåº¦ï¼š0ï¼ˆæ¢ä¸ªæ€è·¯ï¼‰");
      if(hit === 1) hints.push("æœ‰ 1 ä¸ªå­—â€œé è¿‘çœŸç›¸â€äº†ï¼ˆä¸é”™ï¼ï¼‰");
      if(hit >= 2) hints.push("å·²ç»æœ‰ 2 ä¸ªå­—â€œéå¸¸æ¥è¿‘â€äº†ï¼ˆå°±å·®ä¸€ç‚¹ç‚¹ï¼‰");
      if(attempts >= 3) hints.push("é¢å¤–æç¤ºï¼šè¿™æ˜¯ä¸€ä¸ªæ ‡å‡†çš„ä¸­æ–‡å§“åæ ¼å¼");
      return {type:"bad", text: "æ²¡é€šè¿‡ ğŸ˜… " + hints.join("ï¼›")};
    }

    function enter(){
      attempts++;
      const v = normalize(pwd.value);
      const fb = gateFeedback(v);
      gateMsg.className = "msg " + fb.type;
      gateMsg.textContent = fb.text;

      if(v === REAL_PASSWORD){
        statusPill.innerHTML = 'çŠ¶æ€ï¼š<b>å·²éªŒè¯</b> ğŸ”“';
        gate.classList.add("hidden");
        game.classList.remove("hidden");
        startGame();
      }
    }

    enterBtn.addEventListener("click", enter);
    pwd.addEventListener("keydown", (e)=>{ if(e.key==="Enter") enter(); });
    demoBtn.addEventListener("click", ()=>{
      pwd.value = REAL_PASSWORD;
      pwd.focus();
      gateMsg.className="msg";
      gateMsg.textContent="ï¼ˆå·²è‡ªåŠ¨å¡«å…¥æ­£ç¡®å¯†ç ï¼Œç‚¹å‡»â€œéªŒè¯å¹¶è¿›å…¥â€å³å¯ï¼‰";
    });

    // ====== Game Flow ======
    const bar = document.getElementById("bar");
    const stepText = document.getElementById("stepText");

    const panel1 = document.getElementById("panel1");
    const panel2 = document.getElementById("panel2");
    const panel3 = document.getElementById("panel3");
    const panel4 = document.getElementById("panel4");

    const to2 = document.getElementById("to2");
    const to3 = document.getElementById("to3");
    const finishBtn = document.getElementById("finishBtn");

    function setStep(step){
      // step: 1..4
      const pct = step===1? 0 : step===2? 33 : step===3? 66 : 100;
      bar.style.width = pct + "%";
      if(step===1) stepText.textContent = "ç¬¬ 1/3 å…³ï¼šæš–èº«å°é—®ç­”";
      if(step===2) stepText.textContent = "ç¬¬ 2/3 å…³ï¼šæ‹–æ‹½é…å¯¹";
      if(step===3) stepText.textContent = "ç¬¬ 3/3 å…³ï¼šç¿»ç‰Œè®°å¿†";
      if(step===4) stepText.textContent = "ğŸ‰ é€šå…³ï¼šä¸»åŒ…è®¤è¯å·²å‘æ”¾";
    }

    function showPanel(p){
      [panel1,panel2,panel3,panel4].forEach(x=>x.classList.add("hidden"));
      p.classList.remove("hidden");
    }

    function startGame(){
      setStep(1);
      showPanel(panel1);
      initQuiz();
      initMatch();
      initMemory();
    }

    // ====== Panel 1: Quiz ======
    const msg1 = document.getElementById("msg1");
    const choices = document.querySelectorAll(".choice");

    function initQuiz(){
      msg1.className="msg";
      msg1.textContent="ç‚¹å‡»ä½ è®¤ä¸ºæ­£ç¡®çš„é€‰é¡¹ï½";
      to2.classList.add("hidden");
      choices.forEach(c=>{
        c.classList.remove("correct","wrong");
        c.onclick = ()=>{
          const ok = c.dataset.correct === "1";
          choices.forEach(x=>x.classList.remove("correct","wrong"));
          if(ok){
            c.classList.add("correct");
            msg1.className="msg ok";
            msg1.textContent="âœ… é€šè¿‡ï¼ä½ æ˜¯ä¼šçœ‹æç¤ºçš„äººï¼ˆä¸»åŒ…è®¤å¯+1ï¼‰";
            to2.classList.remove("hidden");
          }else{
            c.classList.add("wrong");
            msg1.className="msg bad";
            msg1.textContent="âŒ è¿™ä¸ªé€‰é¡¹å¤ªç¦»è°±å•¦ï½å†é€‰ä¸€æ¬¡ï¼Œåˆ«ç´§å¼ ã€‚";
          }
        };
      });

      to2.onclick = ()=>{
        setStep(2);
        showPanel(panel2);
      };
    }

    // ====== Panel 2: Drag match ======
    const chipsEl = document.getElementById("chips");
    const dropFun = document.getElementById("dropFun");
    const dropMeh = document.getElementById("dropMeh");
    const msg2 = document.getElementById("msg2");

    const matchItems = [
      {txt:"æ¸…æ™°çš„ç›®æ ‡", bin:"fun"},
      {txt:"å³æ—¶åé¦ˆ", bin:"fun"},
      {txt:"ç®€å•æ˜“æ‡‚", bin:"fun"},
      {txt:"çœ‹ä¸æ‡‚ä¹Ÿä¸è§£é‡Š", bin:"meh"},
      {txt:"æ“ä½œå¤ªå¤æ‚", bin:"meh"},
      {txt:"æ²¡æœ‰äº’åŠ¨", bin:"meh"},
    ];

    function shuffle(arr){
      const a = arr.slice();
      for(let i=a.length-1;i>0;i--){
        const j = Math.floor(Math.random()*(i+1));
        [a[i],a[j]]=[a[j],a[i]];
      }
      return a;
    }

    function initMatch(){
      msg2.className="msg";
      msg2.textContent="æŠŠè¯æ¡æ‹–åˆ°ä½ è®¤ä¸ºæ­£ç¡®çš„ç›’å­é‡Œã€‚å…¨æ”¾å¯¹å°±è¿‡å…³ï½";
      to3.classList.add("hidden");

      dropFun.innerHTML = "";
      dropMeh.innerHTML = "";
      chipsEl.innerHTML = "";
      document.querySelectorAll(".bin").forEach(b=>b.classList.remove("good","bad"));

      const items = shuffle(matchItems);

      items.forEach((it, idx)=>{
        const chip = document.createElement("div");
        chip.className="chip";
        chip.textContent = it.txt;
        chip.draggable = true;
        chip.dataset.bin = it.bin;
        chip.dataset.id = "c"+idx;
        chip.addEventListener("dragstart", (e)=>{
          e.dataTransfer.setData("text/plain", chip.dataset.id);
          chip.style.opacity = ".6";
        });
        chip.addEventListener("dragend", ()=>{
          chip.style.opacity = "1";
        });
        chipsEl.appendChild(chip);
      });

      function allowDrop(e){ e.preventDefault(); }

      function onDropFactory(binName, dropZone){
        return function(e){
          e.preventDefault();
          const id = e.dataTransfer.getData("text/plain");
          const chip = chipsEl.querySelector(`[data-id="${id}"]`) || document.querySelector(`[data-id="${id}"]`);
          if(!chip) return;

          // append into the drop zone
          dropZone.appendChild(chip);
          checkMatch();
        }
      }

      const bins = document.querySelectorAll(".bin");
      bins.forEach(b=>{
        b.addEventListener("dragover", allowDrop);
        const binName = b.dataset.bin;
        const zone = binName==="fun" ? dropFun : dropMeh;
        b.addEventListener("drop", onDropFactory(binName, zone));
      });

      function checkMatch(){
        const allChips = document.querySelectorAll(".chip");
        const placed = Array.from(allChips).filter(ch => ch.parentElement !== chipsEl);
        // require all placed
        if(placed.length !== matchItems.length){
          msg2.className="msg";
          msg2.textContent = `å·²æ”¾å…¥ ${placed.length}/${matchItems.length}ï¼Œç»§ç»­ï½`;
          return;
        }

        let ok = true;
        placed.forEach(ch=>{
          const parentBin = ch.closest(".bin").dataset.bin;
          if(parentBin !== ch.dataset.bin) ok = false;
        });

        if(ok){
          msg2.className="msg ok";
          msg2.textContent="âœ… å…¨å¯¹ï¼ä½ å·²ç»æŒæ¡â€œæœ‰è¶£=æ¸…æ™°+äº’åŠ¨+åé¦ˆâ€çš„å¥¥ä¹‰ã€‚";
          document.querySelectorAll(".bin").forEach(b=>b.classList.add("good"));
          to3.classList.remove("hidden");
        }else{
          msg2.className="msg bad";
          msg2.textContent="âŒ æœ‰äº›è¯æ¡æ”¾é”™å•¦ï½è°ƒæ•´ä¸€ä¸‹å†è¯•ã€‚";
          // æ ‡è®°ä¸€ä¸‹ç›’å­çŠ¶æ€
          document.querySelectorAll(".bin").forEach(b=>b.classList.remove("good","bad"));
          document.querySelectorAll(".bin").forEach(b=>b.classList.add("bad"));
        }
      }

      to3.onclick = ()=>{
        setStep(3);
        showPanel(panel3);
      };
    }

    // ====== Panel 3: Memory ======
    const board = document.getElementById("board");
    const movesEl = document.getElementById("moves");
    const pairsEl = document.getElementById("pairs");
    const msg3 = document.getElementById("msg3");
    const resetMem = document.getElementById("resetMem");

    const symbolsBase = ["ğŸ™","ğŸ§‹","ğŸ§","ğŸ§©","ğŸš€","âœ¨"]; // 6 pairs

    let tiles = [];
    let revealed = [];
    let moves = 0;
    let pairs = 0;
    let lock = false;

    function buildMemory(){
      const symbols = shuffle(symbolsBase.concat(symbolsBase));
      tiles = symbols.map((sym, i)=>({
        id:i,
        sym,
        revealed:false,
        matched:false
      }));
      revealed = [];
      moves = 0;
      pairs = 0;
      lock = false;

      movesEl.textContent = "æ­¥æ•°ï¼š0";
      pairsEl.textContent = "é…å¯¹ï¼š0/6";
      msg3.className="msg";
      msg3.textContent = "å¼€å§‹å§ï¼šç¿»å¼€ä¸¤å¼ ç›¸åŒçš„å°±é…å¯¹æˆåŠŸï½";
      finishBtn.classList.add("hidden");

      board.innerHTML = "";
      tiles.forEach(t=>{
        const el = document.createElement("div");
        el.className="tile";
        el.dataset.id = t.id;
        el.textContent = "â“";
        el.addEventListener("click", ()=>onTileClick(t.id));
        board.appendChild(el);
      });
    }

    function renderTile(id){
      const t = tiles[id];
      const el = board.querySelector(`.tile[data-id="${id}"]`);
      if(!el) return;
      el.classList.toggle("revealed", t.revealed && !t.matched);
      el.classList.toggle("matched", t.matched);
      el.textContent = (t.revealed || t.matched) ? t.sym : "â“";
    }

    function onTileClick(id){
      const t = tiles[id];
      if(lock || t.matched || t.revealed) return;

      t.revealed = true;
      renderTile(id);
      revealed.push(id);

      if(revealed.length === 2){
        moves++;
        movesEl.textContent = "æ­¥æ•°ï¼š" + moves;
        const [a,b] = revealed.map(x=>tiles[x]);
        lock = true;

        if(a.sym === b.sym){
          setTimeout(()=>{
            a.matched = true;
            b.matched = true;
            renderTile(a.id); renderTile(b.id);
            pairs++;
            pairsEl.textContent = `é…å¯¹ï¼š${pairs}/6`;
            msg3.className="msg ok";
            msg3.textContent="âœ… é…å¯¹æˆåŠŸï¼ç»§ç»­ï½";
            revealed = [];
            lock = false;

            if(pairs === 6){
              msg3.className="msg ok";
              msg3.textContent="ğŸ‰ å…¨éƒ¨é…å¯¹å®Œæˆï¼ä½ å·²ç»æ˜¯ä¸»åŒ…è®¤è¯ç©å®¶äº†ï¼";
              finishBtn.classList.remove("hidden");
            }
          }, 380);
        }else{
          setTimeout(()=>{
            a.revealed = false;
            b.revealed = false;
            renderTile(a.id); renderTile(b.id);
            msg3.className="msg";
            msg3.textContent="æ²¡é…ä¸Šä¹Ÿæ²¡å…³ç³»ï¼šè®°ä½ä½ç½®å°±è¡Œï½";
            revealed = [];
            lock = false;
          }, 650);
        }
      }
    }

    function initMemory(){
      buildMemory();
      resetMem.onclick = buildMemory;

      finishBtn.onclick = ()=>{
        setStep(4);
        showPanel(panel4);
        popConfetti();
        makeCert();
      };
    }

    // ====== Finish: Certificate ======
    const cert = document.getElementById("cert");
    const copyBtn = document.getElementById("copyBtn");
    const replayBtn = document.getElementById("replayBtn");
    const msg4 = document.getElementById("msg4");

    function makeCert(){
      const now = new Date();
      const pad = n => String(n).padStart(2,"0");
      const ts = `${now.getFullYear()}-${pad(now.getMonth()+1)}-${pad(now.getDate())} ${pad(now.getHours())}:${pad(now.getMinutes())}`;

      const text =
`ã€ä¸»åŒ…è®¤è¯è¯ä¹¦ã€‘âœ…
è®¤è¯äººï¼šä½ ï¼ˆè¶…çº§æœºæ™ºç‰ˆï¼‰
è®¤è¯é¡¹ç›®ï¼š5åˆ†é’Ÿè½»é‡é—¯å…³ Â· ä¸»åŒ…è®¤è¯æµç¨‹
é€šå…³æˆç»©ï¼šç¬¬1å…³ï¼ˆå·²è¿‡ï¼‰/ ç¬¬2å…³ï¼ˆå·²è¿‡ï¼‰/ ç¬¬3å…³ï¼ˆå·²è¿‡ï¼‰
ç‰¹åˆ«è¯´æ˜ï¼šä½ å…·å¤‡â€œçœ‹æç¤ºã€ä¼šäº’åŠ¨ã€èƒ½é€šå…³â€çš„ç¨€æœ‰å“è´¨ã€‚

ä¸»åŒ…å£ä»¤å½©è›‹ï¼šè€¿æ·‘çï¼ˆåˆ«é—®ï¼Œé—®å°±æ˜¯ä¸»åŒ…æœ¬äººï¼‰
ç­¾å‘æ—¶é—´ï¼š${ts}

ç¥ç¦è¯­ï¼šæ„¿ä½ æ¯æ¬¡è¾“å…¥å¯†ç ï¼Œéƒ½åƒè¿™æ¬¡ä¸€æ ·â€”â€”ä¸€æ¬¡å°±å¯¹ï¼Œå¿«ä¹é€šå…³ âœ¨`;

      cert.textContent = text;
      msg4.className="msg";
      msg4.textContent="æç¤ºï¼šå¤åˆ¶åå‘å‡ºå»ï¼ŒèŠ‚ç›®æ•ˆæœä¼šå¾ˆå¥½ ğŸ˜„";
    }

    copyBtn.onclick = async ()=>{
      try{
        await navigator.clipboard.writeText(cert.textContent);
        msg4.className="msg ok";
        msg4.textContent="å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ âœ… å¿«å»åˆ¶é€ å¿«ä¹ï¼";
      }catch(e){
        msg4.className="msg warn";
        msg4.textContent="å¤åˆ¶å¤±è´¥ï¼ˆå¯èƒ½æµè§ˆå™¨ä¸å…è®¸ï¼‰ã€‚ä½ å¯ä»¥æ‰‹åŠ¨å…¨é€‰å¤åˆ¶ã€‚";
      }
    };

    replayBtn.onclick = ()=>{
      // reset all
      setStep(1);
      showPanel(panel1);
      initQuiz();
      initMatch();
      buildMemory();
    };

    // ====== Confetti ======
    const confetti = document.getElementById("confetti");
    function popConfetti(){
      confetti.classList.remove("hidden");
      confetti.innerHTML = "";
      const colors = ["#7c5cff","#00d4ff","#22c55e","#f59e0b","#eaf0ff","#ef4444"];
      const count = 80;
      for(let i=0;i<count;i++){
        const piece = document.createElement("i");
        const left = Math.random()*100;
        const delay = Math.random()*0.2;
        const dur = 1.9 + Math.random()*1.4;
        const dx = (Math.random()*2-1) * 18 + "vw";
        piece.style.left = left + "vw";
        piece.style.top = (-10 - Math.random()*20) + "vh";
        piece.style.background = colors[Math.floor(Math.random()*colors.length)];
        piece.style.animationDuration = dur + "s";
        piece.style.animationDelay = delay + "s";
        piece.style.setProperty("--dx", dx);
        confetti.appendChild(piece);
      }
      setTimeout(()=>confetti.classList.add("hidden"), 2600);
    }
  </script>
</body>
</html>

